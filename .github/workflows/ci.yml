name: Ruby

on:
  [push, pull_request]

permissions:
  contents: read

jobs:
  test:

    runs-on: ubuntu-latest
    strategy:
      matrix:
        ruby-version: ['2.6', '2.7'] #repo doesn't yet support 3.0 :upside_down_face:

    steps:
    - uses: actions/checkout@v3
    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: ${{ matrix.ruby-version }}
    - name: Install dependencies
      run:
        bundle install
    - name: Setup Test Env
      run: |
        touch .env
        echo BT_ENVIRONMENT='${{ secrets.BT_ENVIRONMENT }}' >> .env
        echo BT_MERCHANT_ID='${{ secrets.BT_MERCHANT_ID }}' >> .env
        echo BT_PUBLIC_KEY='${{ secrets.BT_PUBLIC_KEY }}' >> .env
        echo BT_PRIVATE_KEY='${{ secrets.BT_PRIVATE_KEY }}' >> .env
    - name: Run tests
      run: bundle exec rake spec
